<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webhook Data Syncing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" defer></script>
</head>
<body class="bg-gray-100 font-sans text-gray-900 min-h-screen">

<!-- Header -->
<header class="bg-blue-600 text-white p-8 text-center shadow-lg relative overflow-hidden">
    <h1 class="text-4xl font-bold flex justify-center items-center gap-2">
        <i class="fas fa-broadcast-tower"></i>
        Webhook Dashboard
    </h1>
    <p class="opacity-90 mt-1">Real-time webhook monitoring and data visualization</p>
    <!-- Menu -->
    <nav class="absolute top-4 left-4">
        <a href="/" class="text-white font-semibold hover:underline flex items-center gap-1">
            <i class="fas fa-home"></i> Home
        </a>
    </nav>
</header>

<main class="max-w-7xl mx-auto p-6">

    <!-- Statistics -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div class="bg-white rounded-xl shadow p-6 text-center hover:shadow-lg transition">
            <div id="totalWebhooks" class="text-3xl font-bold text-blue-600">0</div>
            <div class="uppercase text-gray-500 font-semibold mt-1">Total Webhooks</div>
        </div>
        <div class="bg-white rounded-xl shadow p-6 text-center hover:shadow-lg transition">
            <div id="todayWebhooks" class="text-3xl font-bold text-blue-600">0</div>
            <div class="uppercase text-gray-500 font-semibold mt-1">Today</div>
        </div>
        <div class="bg-white rounded-xl shadow p-6 text-center hover:shadow-lg transition">
            <div id="lastHour" class="text-3xl font-bold text-blue-600">0</div>
            <div class="uppercase text-gray-500 font-semibold mt-1">Last Hour</div>
        </div>
        <div class="bg-white rounded-xl shadow p-6 text-center hover:shadow-lg transition">
        <span class="inline-flex items-center gap-1 bg-green-100 text-green-600 px-3 py-1 rounded-full font-semibold uppercase text-sm">
          <i class="fas fa-circle"></i> Live
        </span>
            <div class="uppercase text-gray-500 font-semibold mt-1">Status</div>
        </div>
    </div>

    <!-- Configuration & System Info -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">

        <!-- API Configuration -->
        <div class="bg-white rounded-xl shadow p-6 hover:shadow-lg transition">
            <h3 class="text-xl font-semibold flex items-center gap-2 mb-4">
                <i class="fas fa-cog"></i> API Configuration
            </h3>
            <form id="configForm" class="space-y-4">
                <div>
                    <label for="apiUrl" class="block font-medium text-gray-700 uppercase text-xs mb-1">
                        <i class="fas fa-link"></i> API Base URL
                    </label>
                    <input type="url" id="apiUrl" name="apiUrl" required placeholder="https://api.example.com"
                           class="w-full border-2 border-gray-300 rounded-lg p-3 focus:border-blue-600 focus:ring-1 focus:ring-blue-200 outline-none transition">
                </div>
                <div>
                    <label for="apiToken" class="block font-medium text-gray-700 uppercase text-xs mb-1">
                        <i class="fas fa-key"></i> API Token
                    </label>
                    <input type="password" id="apiToken" name="apiToken" required placeholder="Enter your API token"
                           class="w-full border-2 border-gray-300 rounded-lg p-3 focus:border-blue-600 focus:ring-1 focus:ring-blue-200 outline-none transition">
                </div>
                <button type="submit" class="bg-blue-600 text-white px-5 py-3 rounded-lg font-semibold flex items-center gap-2 hover:shadow-lg transition">
                    <i class="fas fa-save"></i> Save Configuration
                </button>
            </form>
            <div id="configMsg" class="mt-4"></div>
        </div>

        <!-- System Information -->
        <div class="bg-white rounded-xl shadow p-6 hover:shadow-lg transition">
            <h3 class="text-xl font-semibold flex items-center gap-2 mb-4">
                <i class="fas fa-info-circle"></i> System Information
            </h3>
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-500">Last Updated:</span>
                    <span id="lastUpdated">Never</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-500">Refresh Interval:</span>
                    <span>5 seconds</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-500">Connection:</span>
                    <span class="inline-flex items-center gap-1 bg-green-100 text-green-600 px-3 py-1 rounded-full font-semibold uppercase text-sm">
              <i class="fas fa-wifi"></i> Connected
            </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Table -->
    <div class="bg-white rounded-xl shadow overflow-x-auto hover:shadow-lg transition">
        <div class="flex justify-between items-center p-6 border-b border-gray-200 bg-gray-50">
            <h3 class="text-xl font-semibold flex items-center gap-2"><i class="fas fa-database"></i> Webhook Data</h3>
            <div id="refreshIndicator" class="flex items-center gap-2 text-gray-500">
                <i class="fas fa-sync-alt animate-spin"></i>
                <span>Auto-refresh active</span>
            </div>
        </div>
        <table class="w-full text-left border-collapse">
            <thead class="bg-gray-50">
            <tr>
                <th class="p-4 uppercase text-xs font-semibold text-gray-700"><i class="fas fa-hashtag"></i> Resource ID</th>
                <th class="p-4 uppercase text-xs font-semibold text-gray-700"><i class="fas fa-clock"></i> Received At</th>
                <th class="p-4 uppercase text-xs font-semibold text-gray-700"><i class="fas fa-code"></i> Payload Data</th>
            </tr>
            </thead>
            <tbody id="dataTable">
            <tr>
                <td colspan="3" class="text-center text-gray-400 py-12">
                    <i class="fas fa-inbox text-4xl mb-2 block"></i>
                    <div>No webhook data available</div>
                    <small>Configure your API settings and start receiving webhooks</small>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

</main>

<script>
    let webhookStats = { total:0, today:0, lastHour:0 };

    document.getElementById('configForm').addEventListener('submit', async e => {
        e.preventDefault();
        const btn = e.target.querySelector('button[type="submit"]');
        const original = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...'; btn.disabled = true;

        const apiUrl = document.getElementById('apiUrl').value;
        const apiToken = document.getElementById('apiToken').value;

        try {
            const res = await fetch('/set-config', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ apiUrl, apiToken })
            });
            const data = await res.json();
            const msgDiv = document.getElementById('configMsg'); msgDiv.innerHTML='';
            const alert = document.createElement('div');
            alert.className = `p-4 rounded ${data.success?'bg-green-100 text-green-600':'bg-red-100 text-red-600'} flex items-center gap-2`;
            alert.innerHTML = `<i class="fas ${data.success?'fa-check-circle':'fa-exclamation-triangle'}"></i> ${data.success?'Configuration saved successfully!':'Error saving configuration. Please try again.'}`;
            msgDiv.appendChild(alert);
            if(data.success){ setTimeout(()=>{ alert.remove(); }, 3000);}
        } catch(e){ console.error(e); }
        finally{ btn.innerHTML=original; btn.disabled=false;}
    });

    async function loadData(){
        const refreshIndicator = document.getElementById('refreshIndicator');
        refreshIndicator.classList.add('text-blue-600');

        try{
            const res = await fetch('/get-data'); const json = await res.json();
            const tbody = document.getElementById('dataTable');

            if(json.success && json.results.length){
                tbody.innerHTML='';
                webhookStats.total = json.results.length;
                webhookStats.today = json.results.filter(i=>isToday(i.receivedAt)).length;
                webhookStats.lastHour = json.results.filter(i=>isLastHour(i.receivedAt)).length;
                updateStats();
                json.results.forEach(item=>{
                    const row = document.createElement('tr');
                    row.innerHTML=`
              <td class="p-4" data-label="Resource ID">
                <code class="bg-indigo-100 px-2 py-1 rounded font-semibold">${item.id}</code>
              </td>
              <td class="p-4" data-label="Received At">
                <div class="flex flex-col gap-1">
                  <span>${formatDate(item.receivedAt)}</span>
                  <small class="text-gray-500">${formatTime(item.receivedAt)}</small>
                </div>
              </td>
              <td class="p-4" data-label="Data">
                <pre class="bg-gray-50 border border-gray-200 p-2 rounded overflow-x-auto">${JSON.stringify(item.data,null,2)}</pre>
              </td>
            `;
                    tbody.appendChild(row);
                });
            } else {
                tbody.innerHTML=`<tr><td colspan="3" class="text-center text-gray-400 py-12">
            <i class="fas fa-inbox text-4xl mb-2 block"></i>
            <div>No webhook data available</div>
            <small>Configure your API settings and start receiving webhooks</small>
          </td></tr>`;
                updateStats();
            }
            document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString();
        } catch(e){ console.error(e); }
        finally{ refreshIndicator.classList.remove('text-blue-600'); }
    }

    function updateStats(){
        document.getElementById('totalWebhooks').textContent = webhookStats.total;
        document.getElementById('todayWebhooks').textContent = webhookStats.today;
        document.getElementById('lastHour').textContent = webhookStats.lastHour;
    }

    function formatDate(date){ return new Date(date).toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'});}
    function formatTime(date){ return new Date(date).toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',second:'2-digit'});}
    function isToday(date){ const d=new Date(date); const t=new Date(); return d.toDateString()===t.toDateString();}
    function isLastHour(date){ const d=new Date(date); return d>=new Date(Date.now()-3600000); }

    setInterval(loadData,5000);
    loadData();
</script>
</body>
</html>
